Segment Tree.  
Time complexity O(logn), Space complexity O(n)